{"version":3,"file":"main.js","mappings":"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","sources":["./src/app/app.component.ts","./src/app/app.module.ts","./src/app/brush/brush.service.ts","./src/app/canvas/CanvasOffscreen.ts","./src/app/canvas/FileHandler.ts","./src/app/canvas/canvas-paint.directive.ts","./src/app/canvas/canvas.service.ts","./src/app/canvas/store.ts","./src/app/coerce-boolean-property.ts","./src/app/color-selector/color-selector.component.ts","./src/app/comments/comments.service.ts","./src/app/common/common.module.ts","./src/app/common/file_value_accessor.ts","./src/app/common/push.pipe.ts","./src/app/croquis/brush/simple.ts","./src/app/croquis/misc.ts","./src/app/croquis/stylus.ts","./src/app/events/pointer.ts","./src/app/file-download.directive.ts","./src/app/file-drop.directive.ts","./src/app/file-drop.ts","./src/app/files-change.ts","./src/app/frame.pipe.ts","./src/app/timecode.pipe.ts","./src/app/timeline/comment.directive.ts","./src/app/timeline/slider.directive.ts","./src/app/timeline/timeline-comment-store.ts","./src/app/timeline/timeline.component.ts","./src/app/timeline/timeline.directive.ts","./src/app/timeline/timeline.module.ts","./src/app/video/secondsToTimecode.ts","./src/app/video/video-scroll.directive.ts","./src/app/video/video.directive.ts","./src/app/video/video.service.ts","./src/app/video/videoTimeToFrame.ts","./src/main.ts","./src/app/app.component.html","./src/app/timeline/timeline.component.html"],"sourcesContent":["import { Component, Inject, Injectable, OnDestroy } from '@angular/core';\nimport { FormControl } from '@angular/forms';\nimport { filter, Subject } from 'rxjs';\n\nimport { BrushService } from './brush/brush.service';\nimport { CanvasService } from './canvas/canvas.service';\nimport { CommentsService } from './comments/comments.service';\nimport { FILES_CHANGE } from './files-change';\nimport { VideoService } from './video/video.service';\n\n\nconst FRAME_RATES = [\n  { name: 'film: 24', value: 24 },\n  { name: 'NTSC: 29.97', value: 29.97 },\n  { name: 'NTSC_Film: 23.976', value: 23.976 },\n  { name: 'NTSC_HD: 59.94', value: 59.94 },\n  { name: 'PAL: 25', value: 25 },\n  { name: 'PAL_HD: 50', value: 50 },\n  { name: 'web: 30', value: 30 },\n  { name: 'high: 60', value: 60 },\n];\n\n\n\n@Injectable()\nexport class FrameRateService implements OnDestroy {\n  control = new FormControl(this.video.fps$.value);\n  private subscription = this.control.valueChanges.pipe(\n    filter((fps) => fps > 0 && fps < 9000),\n  ).subscribe((fps) => {\n    this.video.fps$.next(fps)\n  })\n\n  constructor(\n    @Inject(VideoService) private readonly video: VideoService,\n  ) {}\n\n  ngOnDestroy(): void {\n    this.subscription.unsubscribe();\n  }\n}\n\n\n\n@Component({\n  selector: 'my-app',\n  templateUrl: './app.component.html',\n  styleUrls: ['./app.component.scss'],\n  providers: [\n    VideoService,\n    CommentsService,\n    CanvasService,\n    BrushService,\n    FrameRateService,\n  ]\n})\nexport class AppComponent {\n  frameRates = FRAME_RATES;\n\n  videoInput$ = this.video.video$;\n  src$ = this.video.src$;\n  fps$ = this.video.fps$;\n  currentFrame$ = this.video.currentFrame$;\n  currentTime$ = this.video.currentTime$;\n  totalFrames$ = this.video.totalFrames$;\n\n  constructor(\n    readonly frameRate: FrameRateService,\n    @Inject(BrushService) readonly brush: BrushService,\n    @Inject(CommentsService) readonly comments: CommentsService,\n    @Inject(VideoService) private readonly video: VideoService,\n    @Inject(FILES_CHANGE) readonly filesInput: Subject<FileList>,\n  ) {}\n}\n\n","import { NgModule } from '@angular/core';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { BrowserModule } from '@angular/platform-browser';\n\nimport { AppComponent } from './app.component';\nimport { CanvasPaintDirective } from './canvas/canvas-paint.directive';\nimport { ColorSelectorComponent } from './color-selector/color-selector.component';\nimport { AppCommonModule } from './common/common.module';\nimport { FileDownloadDirective } from './file-download.directive';\nimport { FileDropDirective } from './file-drop.directive';\nimport { FramePipe } from './frame.pipe';\nimport { TimecodePipe } from './timecode.pipe';\nimport { TimelineModule } from './timeline/timeline.module';\nimport { ScrollDirective } from './video/video-scroll.directive';\nimport { VideoDirective } from './video/video.directive';\n\n@NgModule({\n  imports:      [\n    BrowserModule,\n    FormsModule,\n    ReactiveFormsModule,\n    [\n      TimelineModule,\n      AppCommonModule,\n    ],\n  ],\n  declarations: [\n    FileDropDirective,\n    AppComponent,\n    CanvasPaintDirective,\n    FileDownloadDirective,\n    VideoDirective,\n    [\n      TimecodePipe,\n      FramePipe,\n    ],\n    [\n      ColorSelectorComponent,\n      ScrollDirective,\n    ],\n  ],\n  bootstrap:    [\n    AppComponent,\n  ]\n})\nexport class AppModule { }\n","import { Injectable } from \"@angular/core\";\r\nimport { BehaviorSubject } from \"rxjs\";\r\n\r\nexport const DEFAULT_BRUSH_COLOR = '#ffffff';\r\n\r\nconst COMPOSITE_OPERATIONS = [\r\n  'source-over',\r\n  // 'source-in',\r\n  // 'source-out',\r\n  'source-atop',\r\n  'destination-over',\r\n  // 'destination-in',\r\n  'destination-out',\r\n  // 'destination-atop',\r\n  'lighter',\r\n  // 'copy',\r\n  // 'xor',\r\n  'multiply',\r\n  'screen',\r\n  'overlay',\r\n  'darken',\r\n  'lighten',\r\n  'color-dodge',\r\n  'color-burn',\r\n  'hard-light',\r\n  'soft-light',\r\n  // 'difference',\r\n  'exclusion',\r\n  'hue',\r\n  'saturation',\r\n  'color',\r\n  'luminosity',\r\n]\r\n\r\n@Injectable()\r\nexport class BrushService {\r\n  color$ = new BehaviorSubject(DEFAULT_BRUSH_COLOR);\r\n  size$ = new BehaviorSubject(20);\r\n\r\n  compositeOperations = COMPOSITE_OPERATIONS.map((value) => ({ name: value, value }))\r\n  compositeOperation$ = new BehaviorSubject(COMPOSITE_OPERATIONS[0]);\r\n}","export class CanvasOffscreen {\r\n  canvas = new OffscreenCanvas(this.w, this.h);\r\n  readonly ctx = this.canvas.getContext('2d')! as any as CanvasRenderingContext2D;\r\n\r\n  constructor(\r\n    private w: number,\r\n    private h: number\r\n  ) {}\r\n\r\n  readonly empty = this.ctx.createImageData(this.canvas.width, this.canvas.height);\r\n\r\n  imageToImageData(image: CanvasImageSource): ImageData {\r\n    this.clear();\r\n    this.drawImage(image);\r\n    const imageData = this.getImageData();\r\n    this.clear();\r\n    \r\n    return imageData;\r\n  }\r\n\r\n  getImageData(): ImageData {\r\n    return this.ctx.getImageData(0, 0, this.canvas.width, this.canvas.height);\r\n  }\r\n\r\n  drawImage(image: CanvasImageSource): void {\r\n    this.ctx.drawImage(image, 0, 0);\r\n  }\r\n\r\n  clear(): void {\r\n    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n  }\r\n\r\n  imageDataToBlop(imageData: ImageData): Promise<Blob> {\r\n    this.ctx.putImageData(imageData, 0, 0)\r\n  \r\n    const blob = (this.canvas as any)[(this.canvas as any).convertToBlob\r\n      ? 'convertToBlob'\r\n      : 'toBlob'\r\n    ]();\r\n  \r\n    return blob;\r\n  };\r\n}","import { Frame } from '../interfaces/Frame';\r\nimport { CanvasOffscreen } from './CanvasOffscreen';\r\n\r\nexport class FileHandler {\r\n\r\n  constructor(\r\n    private readonly canvas: CanvasOffscreen\r\n  ) {}\r\n\r\n  async restore(file: File): Promise<Map<Frame, ImageData>> {\r\n\r\n    const reader = new FileReader();\r\n    reader.readAsText(file);\r\n  \r\n    const str = await new Promise<string | ArrayBuffer>((resolve, reject) => {\r\n      reader.onload = () => {\r\n        const result = reader.result;\r\n        result ? resolve(result) : reject();\r\n      }\r\n    });\r\n  \r\n    const entries = Object.entries(JSON.parse(str as string)) as [string,string][];\r\n    \r\n    const dataPromises = entries.map(([key, value]) => {\r\n      const img = new Image();\r\n      img.src = value;\r\n  \r\n      return new Promise<ImageData>((resolve, reject) => {\r\n        img.onload = () => {\r\n          const imageData = this.canvas.imageToImageData(img);\r\n          resolve(imageData);\r\n        }\r\n      })\r\n    });\r\n  \r\n    const data2 = await Promise.all(dataPromises);\r\n  \r\n    const filledData = entries.reduce((accumulator, [key, _], index) => {\r\n      accumulator.set(parseInt(key, 10), data2[index]);\r\n  \r\n      return accumulator;\r\n    }, new Map())\r\n  \r\n    return filledData;\r\n  }\r\n\r\n  async save(data: Map<Frame, ImageData>): Promise<File> {\r\n\r\n    const base64Images: Promise<string | ArrayBuffer>[] = [];\r\n    const keys: Frame[] = [];\r\n\r\n    for (const [key, img] of data) {\r\n      const base64 = this.canvas.imageDataToBlop(img).then((blob) => blobToBase64(blob));\r\n      base64Images.push(base64);\r\n      keys.push(key)\r\n    }\r\n  \r\n    const images = await Promise.all(base64Images);\r\n  \r\n    const dataImages = images.reduce((accumulator, img, index) => {\r\n      const key = keys[index];\r\n      accumulator[key] = img;\r\n      return accumulator;\r\n    }, {} as { [key: string]: string | ArrayBuffer });\r\n  \r\n    const json = JSON.stringify(dataImages, (key, value) => {\r\n      if (value instanceof ImageData) {\r\n        return data.get(parseInt(key, 10) as Frame);\r\n      }\r\n  \r\n      return value\r\n    });\r\n\r\n    const file = new File([json], 'foo.json', { type: 'text/json' });\r\n  \r\n    return file;\r\n  }\r\n}\r\n\r\nconst blobToBase64 = (blob: Blob): Promise<string | ArrayBuffer> => {\r\n  const reader = new FileReader();\r\n  reader.readAsDataURL(blob);\r\n\r\n  return new Promise((resolve, reject) => {\r\n    reader.onload = () => {\r\n      const result = reader.result;\r\n      result\r\n        ? resolve(result)\r\n        : reject();\r\n    };\r\n  })\r\n}","import { Directive, ElementRef, Inject, OnDestroy } from '@angular/core';\r\nimport { combineLatest, Subscription } from 'rxjs';\r\n\r\nimport { CommentsService } from '../comments/comments.service';\r\nimport { CanvasService } from './canvas.service';\r\n\r\n@Directive({\r\n  selector: `canvas[paint]`,\r\n})\r\nexport class CanvasPaintDirective implements OnDestroy {\r\n\r\n\r\n  private subscription = new Subscription();\r\n\r\n  constructor(\r\n    elementRef: ElementRef<HTMLCanvasElement>,\r\n    @Inject(CanvasService) canvas: CanvasService,\r\n    @Inject(CommentsService) comments: CommentsService\r\n  ) {\r\n    canvas.canvas$.next(elementRef.nativeElement);\r\n\r\n    this.subscription.add(\r\n      combineLatest([canvas.ctx$, comments.currentImage$]).subscribe(([ctx, img]) => {\r\n        if (img) {\r\n          ctx.putImageData(img, 0, 0);\r\n        } else {\r\n          ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n        }\r\n      })\r\n    );\r\n\r\n    // this.subscription.add(\r\n    //   combineLatest([ctx$, player.clear$]).subscribe(([ctx]) => {\r\n    //     ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n    //   })\r\n    // )\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.subscription.unsubscribe();\r\n  }\r\n}\r\n","import { Inject, Injectable } from '@angular/core';\r\nimport {\r\n  combineLatest,\r\n  exhaustMap,\r\n  last,\r\n  map,\r\n  Observable,\r\n  ReplaySubject,\r\n  shareReplay,\r\n  switchMap,\r\n  takeUntil,\r\n  tap,\r\n} from 'rxjs';\r\n\r\nimport { BrushService } from '../brush/brush.service';\r\nimport { stroke } from '../croquis/brush/simple';\r\nimport { getStylusState } from '../croquis/stylus';\r\nimport { pointerdown, pointermove, pointerup } from '../events/pointer';\r\n\r\n@Injectable()\r\nexport class CanvasService {\r\n  canvas$ = new ReplaySubject<HTMLCanvasElement>();\r\n  ctx$ = canvasContext(this.canvas$);\r\n  paint$ = canvasPaint(this.ctx$, this.brush.color$, this.brush.size$, this.brush.compositeOperation$);\r\n\r\n  constructor(\r\n    @Inject(BrushService) private readonly brush: BrushService,\r\n  ) {}\r\n}\r\n\r\n\r\n\r\n\r\n\r\nexport function canvasContext(\r\n  canvas$: Observable<HTMLCanvasElement>\r\n): Observable<CanvasRenderingContext2D> {\r\n  return canvas$.pipe(\r\n    map((canvas) => {\r\n      \r\n      canvas.height = canvas.offsetHeight;\r\n      canvas.width = canvas.offsetWidth;\r\n\r\n      return canvas.getContext('2d')!;\r\n    }),\r\n    tap((e) => {\r\n      console.log(`canvas`, e);\r\n    }),\r\n    shareReplay(),\r\n  ); \r\n}\r\n\r\nexport function canvasPaint(\r\n  ctx$: Observable<CanvasRenderingContext2D>,\r\n  color$: Observable<string>,\r\n  size$: Observable<number>,\r\n  globalCompositeOperation$: Observable<string>,\r\n) {\r\n  return combineLatest([ctx$, color$, size$, globalCompositeOperation$]).pipe(\r\n    switchMap(([ctx, color, size, globalCompositeOperation]) => {\r\n\r\n      const down = pointerdown(ctx.canvas);\r\n      const move = pointermove(ctx.canvas);\r\n      const up = pointerup(ctx.canvas);\r\n      \r\n      return down.pipe(\r\n\r\n        map((event) => stroke.down({\r\n          ctx,\r\n          color,\r\n          size,\r\n          globalCompositeOperation,\r\n        }, getStylusState(event))),\r\n    \r\n        exhaustMap((drawingContext) => move.pipe(\r\n            map((event) => drawingContext.move(getStylusState(event))),\r\n            takeUntil(up.pipe(\r\n              map((event) => drawingContext.up(getStylusState(event)))\r\n            )),\r\n            last(),\r\n            map(() => ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height)),\r\n        )),\r\n      )\r\n    })\r\n  );\r\n}\r\n","import { Observable, scan } from \"rxjs\";\r\nimport { shareReplay } from \"rxjs/operators\";\r\n\r\nexport const store = <T>(actions$: Observable<(store: T) => T>, init = {} as T): Observable<T> => actions$.pipe(\r\n  scan((accumulator, fn) => fn(accumulator), init),\r\n  shareReplay(),\r\n);\r\n","export function coerceBooleanProperty(value: any): boolean {\r\n  return value != null && `${value}` !== 'false';\r\n}","import { Component, Inject } from '@angular/core';\r\n\r\nimport { BrushService } from '../brush/brush.service';\r\n\r\n@Component({\r\n  selector: 'color-selector',\r\n  template: `\r\n  \r\n  <input type=\"color\"\r\n       [ngModel]=\"brush.color$ | push\"\r\n       (ngModelChange)=\"brush.color$.next($event)\">\r\n  \r\n  `,\r\n})\r\nexport class ColorSelectorComponent {\r\n\r\n  constructor(\r\n    @Inject(BrushService) readonly brush: BrushService,\r\n  ) {}\r\n}\r\n","import { Inject, Injectable } from '@angular/core';\r\nimport {\r\n  combineLatest,\r\n  filter,\r\n  map,\r\n  merge,\r\n  Observable,\r\n  ReplaySubject,\r\n  shareReplay,\r\n  Subject,\r\n  switchMap,\r\n  tap,\r\n  withLatestFrom,\r\n} from 'rxjs';\r\n\r\nimport { CanvasService } from '../canvas/canvas.service';\r\nimport { CanvasOffscreen } from '../canvas/CanvasOffscreen';\r\nimport { FileHandler } from '../canvas/FileHandler';\r\nimport { store } from '../canvas/store';\r\nimport { FILES_CHANGE } from '../files-change';\r\nimport { Frame } from '../interfaces/Frame';\r\nimport { VideoService } from '../video/video.service';\r\n\r\n@Injectable()\r\nexport class CommentsService {\r\n  add$ = new ReplaySubject<[Frame, ImageData]>();\r\n\r\n  fileHandler$ = fileHandler(this.canvas.ctx$);\r\n\r\n  restore$ = commentRestore(commentFileChange(this.files$), this.fileHandler$);\r\n\r\n  move$ = new ReplaySubject<Map<Frame, ImageData>>();\r\n  remove$ = new Subject<Frame>();\r\n  store$ = commentStore(this.move$, this.restore$, this.canvas.paint$, this.video.currentFrame$, this.remove$);\r\n  \r\n  currentImage$ = commentCurrentImage(this.video.currentFrame$, this.store$);\r\n\r\n  save$ = new Subject<void>();\r\n  file$ = commentSaveFile(this.save$, this.store$, this.fileHandler$);\r\n\r\n  constructor(\r\n    @Inject(FILES_CHANGE) private readonly files$: Observable<FileList>,\r\n    @Inject(CanvasService) private readonly canvas: CanvasService,\r\n    @Inject(VideoService) private readonly video: VideoService,\r\n  ) {}\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\nexport function commentStore(\r\n  move$: Observable<Map<Frame, ImageData>>,\r\n  restore$: Observable<Map<Frame, ImageData>>,\r\n  paint$: Observable<ImageData>,\r\n  currentFrame$: Observable<Frame>,\r\n  remove$: Observable<Frame>,\r\n): Observable<Map<Frame, ImageData>> {\r\n  return store(\r\n    merge(\r\n      merge(\r\n        move$,\r\n        restore$,\r\n      ).pipe(\r\n        map((data) => () => data),\r\n      ),\r\n      paint$.pipe(\r\n        withLatestFrom(currentFrame$),\r\n        map(([imageData, frame]) => (store: Map<Frame, ImageData>) => {\r\n          store.set(frame, imageData);\r\n    \r\n          return store;\r\n        }),\r\n      ),\r\n      remove$.pipe(\r\n        map((frame: Frame) => (store: Map<Frame, ImageData>) => {\r\n          store.delete(frame);\r\n    \r\n          return store;\r\n        })\r\n      ),\r\n    ),\r\n    new Map(),\r\n  ).pipe(\r\n    tap((e) => {\r\n      console.log(`store`, e);\r\n    }),\r\n    shareReplay(),\r\n  );\r\n}\r\n\r\nexport function commentSaveFile(\r\n  save$: Observable<void>,\r\n  data$: Observable<Map<Frame, ImageData>>,\r\n  fileHandler$: Observable<FileHandler>,\r\n): Observable<File> {\r\n  return save$.pipe(\r\n    withLatestFrom(data$, fileHandler$),\r\n    switchMap(([_, data, fileHandler]) => fileHandler.save(data)),\r\n    shareReplay(),\r\n  )\r\n}\r\n\r\nexport function commentCurrentImage(\r\n  currentFrame$: Observable<Frame>,\r\n  store$: Observable<Map<Frame, ImageData>>,\r\n): Observable<ImageData | undefined> {\r\n  return combineLatest([\r\n    store$,\r\n    currentFrame$,\r\n  ]).pipe(\r\n    map(([data, frame])=> data.get(frame)),\r\n    // map(([frame, data])=> closest(frame, data) ?? undefined),\r\n    shareReplay(),\r\n  )\r\n}\r\n\r\nexport function commentFileChange(\r\n  files$: Observable<FileList>,\r\n) {\r\n  return files$.pipe(\r\n    map((files) => Array.from(files)),\r\n    map((files) => files.find(isJsonFile)!),\r\n    filter((v) => !!v),\r\n  );\r\n}\r\n\r\nfunction isJsonFile(file: File) {\r\n  return file.type === 'application/json';\r\n}\r\n\r\nexport function commentRestore(\r\n  file$: Observable<File>,\r\n  fileHandler$: Observable<FileHandler>,\r\n): Observable<Map<Frame, ImageData>> {\r\n  return file$.pipe(\r\n    withLatestFrom(fileHandler$),\r\n    switchMap(([file, fileHandler]) => fileHandler.restore(file)),\r\n    shareReplay(),\r\n  );\r\n}\r\n\r\nexport function fileHandler(\r\n  ctx$: Observable<CanvasRenderingContext2D>\r\n) {\r\n  const offscreenCanvas$ = ctx$.pipe(\r\n    map(({ canvas }) => new CanvasOffscreen(canvas.offsetWidth, canvas.offsetHeight))\r\n  );\r\n\r\n  const fileHandler$ = offscreenCanvas$.pipe(\r\n    map((offscreenCanvas) => new FileHandler(offscreenCanvas)),\r\n    shareReplay(),\r\n  );\r\n\r\n  return fileHandler$;\r\n}","import { NgModule } from '@angular/core';\r\n\r\nimport { FileValueAccessor } from './file_value_accessor';\r\nimport { PushPipe } from './push.pipe';\r\n\r\n@NgModule({\r\n  declarations: [\r\n    PushPipe,\r\n    FileValueAccessor,\r\n  ],\r\n  exports: [\r\n    PushPipe,\r\n    FileValueAccessor,\r\n  ]\r\n})\r\nexport class AppCommonModule { }\r\n","import { Directive, ElementRef, forwardRef, Input, Renderer2 } from '@angular/core';\r\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\r\n\r\n@Directive({\r\n  selector: `input[type=file][formControlName],\r\n             input[type=file][formControl],\r\n             input[type=file][ngModel]`,\r\n  host: {\r\n    '(input)': 'onChange($event.target.files)',\r\n    '(blur)': 'onTouched()'\r\n  },\r\n  providers: [\r\n    {\r\n      provide: NG_VALUE_ACCESSOR,\r\n      useExisting: forwardRef(() => FileValueAccessor),\r\n      multi: true\r\n    }\r\n  ]\r\n})\r\nexport class FileValueAccessor implements ControlValueAccessor {\r\n\r\n  @Input() multiple!: any;\r\n\r\n  onChange = (_: any) => {};\r\n  onTouched = () => {};\r\n\r\n  constructor(\r\n    private renderer: Renderer2,\r\n    private elementRef: ElementRef\r\n  ) {}\r\n\r\n  writeValue(value: number): void {}\r\n\r\n  registerOnChange(fn: (_: any) => {}): void {\r\n    this.onChange = (value: FileList) => {\r\n      fn(value);\r\n    };\r\n  }\r\n\r\n  registerOnTouched(fn: () => void): void {\r\n    this.onTouched = fn;\r\n  }\r\n\r\n  setDisabledState(isDisabled: boolean): void {\r\n    this.setProperty('disabled', isDisabled);\r\n  }\r\n\r\n  protected setProperty(key: string, value: any): void {\r\n    this.renderer.setProperty(this.elementRef.nativeElement, key, value);\r\n  }\r\n}\r\n","import {\r\n  ChangeDetectorRef,\r\n  EventEmitter,\r\n  OnDestroy,\r\n  Pipe,\r\n  PipeTransform,\r\n  Type,\r\n  stringify as stringify,\r\n  isPromise,\r\n  isSubscribable,\r\n} from '@angular/core';\r\nimport { Observable, Subscribable, Unsubscribable } from 'rxjs';\r\n\r\nexport function invalidPipeArgumentError(type: Type<any>, value: Object) {\r\n  return Error(`InvalidPipeArgument: '${value}' for pipe '${stringify(type)}'`);\r\n}\r\n\r\ninterface SubscriptionStrategy {\r\n  createSubscription(\r\n    async: Subscribable<any> | Promise<any>,\r\n    updateLatestValue: any\r\n  ): Unsubscribable | Promise<any>;\r\n  dispose(subscription: Unsubscribable | Promise<any>): void;\r\n  onDestroy(subscription: Unsubscribable | Promise<any>): void;\r\n}\r\n\r\nclass SubscribableStrategy implements SubscriptionStrategy {\r\n  createSubscription(\r\n    async: Subscribable<any>,\r\n    updateLatestValue: any\r\n  ): Unsubscribable {\r\n    return async.subscribe({\r\n      next: updateLatestValue,\r\n      error: (e: any) => {\r\n        throw e;\r\n      },\r\n    });\r\n  }\r\n\r\n  dispose(subscription: Unsubscribable): void {\r\n    subscription.unsubscribe();\r\n  }\r\n\r\n  onDestroy(subscription: Unsubscribable): void {\r\n    subscription.unsubscribe();\r\n  }\r\n}\r\n\r\nclass PromiseStrategy implements SubscriptionStrategy {\r\n  createSubscription(\r\n    async: Promise<any>,\r\n    updateLatestValue: (v: any) => any\r\n  ): Promise<any> {\r\n    return async.then(updateLatestValue, (e) => {\r\n      throw e;\r\n    });\r\n  }\r\n\r\n  dispose(subscription: Promise<any>): void {}\r\n\r\n  onDestroy(subscription: Promise<any>): void {}\r\n}\r\n\r\nconst promiseStrategy = new PromiseStrategy();\r\nconst subscribableStrategy = new SubscribableStrategy();\r\n\r\n/**\r\n * @ngModule CommonModule\r\n * @description\r\n *\r\n * Unwraps a value from an asynchronous primitive.\r\n *\r\n * The `async` pipe subscribes to an `Observable` or `Promise` and returns the latest value it has\r\n * emitted. When a new value is emitted, the `async` pipe marks the component to be checked for\r\n * changes. When the component gets destroyed, the `async` pipe unsubscribes automatically to avoid\r\n * potential memory leaks.\r\n *\r\n * @usageNotes\r\n *\r\n * ### Examples\r\n *\r\n * This example binds a `Promise` to the view. Clicking the `Resolve` button resolves the\r\n * promise.\r\n *\r\n * {@example common/pipes/ts/async_pipe.ts region='AsyncPipePromise'}\r\n *\r\n * It's also possible to use `async` with Observables. The example below binds the `time` Observable\r\n * to the view. The Observable continuously updates the view with the current time.\r\n *\r\n * {@example common/pipes/ts/async_pipe.ts region='AsyncPipeObservable'}\r\n *\r\n * @publicApi\r\n */\r\n@Pipe({ name: 'push', pure: false })\r\nexport class PushPipe implements OnDestroy, PipeTransform {\r\n  private latestValue: any = null;\r\n\r\n  private subscription: Unsubscribable | Promise<any> | null = null;\r\n  private obj: Subscribable<any> | Promise<any> | EventEmitter<any> | null =\r\n    null;\r\n  private strategy: SubscriptionStrategy = null!;\r\n\r\n  constructor(\r\n    private cd: ChangeDetectorRef,\r\n  ) {}\r\n\r\n  ngOnDestroy(): void {\r\n    if (this.subscription) {\r\n      this.dispose();\r\n    }\r\n  }\r\n\r\n  // NOTE(@benlesh): Because Observable has deprecated a few call patterns for `subscribe`,\r\n  // TypeScript has a hard time matching Observable to Subscribable, for more information\r\n  // see https://github.com/microsoft/TypeScript/issues/43643\r\n\r\n  transform<T>(obj: Observable<T> | Subscribable<T> | Promise<T>): T | null;\r\n  transform<T>(obj: null | undefined): null;\r\n  transform<T>(\r\n    obj: Observable<T> | Subscribable<T> | Promise<T> | null | undefined\r\n  ): T | null;\r\n  transform<T>(\r\n    obj: Observable<T> | Subscribable<T> | Promise<T> | null | undefined\r\n  ): T | null {\r\n    if (!this.obj) {\r\n      if (obj) {\r\n        this.subscribe(obj);\r\n      }\r\n      return this.latestValue;\r\n    }\r\n\r\n    if (obj !== this.obj) {\r\n      this.dispose();\r\n      return this.transform(obj);\r\n    }\r\n\r\n    return this.latestValue;\r\n  }\r\n\r\n  private subscribe(\r\n    obj: Subscribable<any> | Promise<any> | EventEmitter<any>\r\n  ): void {\r\n    this.obj = obj;\r\n    this.strategy = this.selectStrategy(obj);\r\n    this.subscription = this.strategy.createSubscription(\r\n      obj,\r\n      (value: Object) => this.updateLatestValue(obj, value)\r\n    );\r\n  }\r\n\r\n  private selectStrategy(\r\n    obj: Subscribable<any> | Promise<any> | EventEmitter<any>\r\n  ): any {\r\n    if (isPromise(obj)) {\r\n      return promiseStrategy;\r\n    }\r\n\r\n    if (isSubscribable(obj)) {\r\n      return subscribableStrategy;\r\n    }\r\n\r\n    throw invalidPipeArgumentError(PushPipe, obj);\r\n  }\r\n\r\n  private dispose(): void {\r\n    this.strategy.dispose(this.subscription!);\r\n    this.latestValue = null;\r\n    this.subscription = null;\r\n    this.obj = null;\r\n  }\r\n\r\n  private updateLatestValue(async: any, value: Object): void {\r\n    if (async === this.obj) {\r\n      this.latestValue = value;\r\n      this.cd.detectChanges();\r\n      // markDirty((this.viewContainerRef as any)?._hostView?.[8]);\r\n      // this._ref\r\n    }\r\n  }\r\n}\r\n","import type { Circle } from '../geometry';\r\nimport type { StylusState } from '../stylus';\r\nimport { cloneStylusState, copyStylusState } from '../stylus';\r\nimport type { StrokeProtocol, StrokeDrawingContext } from '../stroke-protocol';\r\nimport { dummyCanvasContext } from '../misc';\r\n\r\nexport type BrushContext = CanvasRenderingContext2D;\r\n\r\nexport interface BrushConfig {\r\n  ctx: BrushContext;\r\n  color: string;\r\n  size: number;\r\n  globalCompositeOperation: string;\r\n}\r\n\r\nexport const defaultBrushConfig = Object.freeze<BrushConfig>({\r\n  ctx: dummyCanvasContext,\r\n  color: '#000',\r\n  size: 10,\r\n  globalCompositeOperation: 'source-over',\r\n});\r\n\r\nexport interface BrushStrokeState {\r\n  prev: StylusState;\r\n  // boundingRect: Rect;\r\n}\r\n\r\nexport interface BrushStrokeResult {\r\n  // boundingRect: Rect;\r\n}\r\n\r\nexport type BrushStroke = StrokeProtocol<BrushConfig, BrushStrokeState, BrushStrokeResult>;\r\n\r\nexport const stroke: BrushStroke = {\r\n  resume(config, prevState) {\r\n    return getDrawingContext(stroke, config, prevState);\r\n  },\r\n  down(config, curr) {\r\n    const state: BrushStrokeState = {\r\n      prev: cloneStylusState(curr),\r\n    };\r\n    const drawingContext = getDrawingContext(stroke, config, state);\r\n\r\n    if (curr.pressure <= 0) {\r\n      return drawingContext;\r\n    }\r\n\r\n    config.ctx.save();\r\n    config.ctx.globalCompositeOperation = config.globalCompositeOperation;\r\n    config.ctx.fillStyle = config.color;\r\n    drawCircle(config.ctx, stylusStateToCircle(curr, config.size));\r\n    config.ctx.restore();\r\n    return drawingContext;\r\n  },\r\n};\r\n\r\nfunction getDrawingContext(\r\n  stroke: StrokeProtocol,\r\n  config: BrushConfig,\r\n  state: BrushStrokeState\r\n): StrokeDrawingContext<BrushConfig, BrushStrokeState, BrushStrokeResult> {\r\n  return {\r\n    getConfig(target?: StrokeProtocol) {\r\n      if (!target || target === stroke) return config;\r\n      throw undefined;\r\n    },\r\n    getState(target?: StrokeProtocol) {\r\n      if (!target || target === stroke) return state;\r\n      throw undefined;\r\n    },\r\n    move(curr) {\r\n      const c1 = stylusStateToCircle(state.prev, config.size);\r\n      const c2 = stylusStateToCircle(curr, config.size);\r\n      config.ctx.save();\r\n      config.ctx.globalCompositeOperation = config.globalCompositeOperation;\r\n      config.ctx.fillStyle = config.color;\r\n      drawCapsule(config.ctx, c1, c2);\r\n      copyStylusState(state.prev, curr);\r\n      config.ctx.restore();\r\n    },\r\n    up(curr) {\r\n      const c1 = stylusStateToCircle(state.prev, config.size);\r\n      const c2 = stylusStateToCircle(curr, config.size);\r\n      config.ctx.save();\r\n      config.ctx.globalCompositeOperation = config.globalCompositeOperation;\r\n      config.ctx.fillStyle = config.color;\r\n      drawCapsule(config.ctx, c1, c2);\r\n      copyStylusState(state.prev, curr);\r\n      config.ctx.restore();\r\n      return {\r\n        // boundingRect: state.boundingRect,\r\n      };\r\n    },\r\n  };\r\n}\r\n\r\nfunction stylusStateToCircle(stylusState: StylusState, size: number): Circle {\r\n  return { x: stylusState.x, y: stylusState.y, r: stylusState.pressure * size * 0.5 };\r\n}\r\n\r\nfunction drawCapsule(ctx: BrushContext, c1: Circle, c2: Circle) {\r\n  const c1IsBig = c1.r > c2.r;\r\n  const big = c1IsBig ? c1 : c2;\r\n  const small = c1IsBig ? c2 : c1;\r\n  const d = Math.sqrt((c2.x - c1.x) ** 2 + (c2.y - c1.y) ** 2);\r\n  if (big.r > small.r + d) return drawCircle(ctx, big);\r\n  if (big.r === small.r) {\r\n    drawCapsuleCase1(ctx, big, small);\r\n  } else {\r\n    drawCapsuleCase2(ctx, big, small);\r\n  }\r\n}\r\n\r\nfunction drawCircle(ctx: BrushContext, circle: Circle) {\r\n  ctx.beginPath();\r\n  ctx.moveTo(circle.x + circle.r, circle.y);\r\n  ctx.arc(circle.x, circle.y, circle.r, 0, Math.PI * 2);\r\n  ctx.closePath();\r\n  ctx.fill();\r\n}\r\n\r\nconst quarter = Math.PI / 2;\r\n\r\nfunction drawCapsuleCase1(ctx: BrushContext, c1: Circle, c2: Circle) {\r\n  drawCircle(ctx, c1);\r\n  drawCircle(ctx, c2);\r\n  const c = Math.atan2(c2.y - c1.y, c2.x - c1.x);\r\n  const i = c - quarter;\r\n  const j = c + quarter;\r\n  const idx = Math.cos(i) * c2.r;\r\n  const idy = Math.sin(i) * c2.r;\r\n  const jdx = Math.cos(j) * c2.r;\r\n  const jdy = Math.sin(j) * c2.r;\r\n  ctx.beginPath();\r\n  ctx.moveTo(c2.x + idx, c2.y + idy);\r\n  ctx.lineTo(c1.x + idx, c1.y + idy);\r\n  ctx.lineTo(c1.x + jdx, c1.y + jdy);\r\n  ctx.lineTo(c2.x + jdx, c2.y + jdy);\r\n  ctx.closePath();\r\n  ctx.fill();\r\n}\r\n\r\nfunction drawCapsuleCase2(ctx: BrushContext, c1: Circle, c2: Circle) {\r\n  drawCircle(ctx, c1);\r\n  drawCircle(ctx, c2);\r\n  const x = c2.x - c1.x || 1e-9;\r\n  const y = c2.y - c1.y;\r\n  const r = c1.r - c2.r;\r\n  const r2 = r * r;\r\n  const x2 = x * x;\r\n  const x3 = x * x * x;\r\n  const y2 = y * y;\r\n  const ax =\r\n    (x === 0 ? c1.r : (y * Math.sqrt(r2 * x2 * (-r2 + x2 + y2)) + r2 * x2) / (x3 + x * y2)) + c1.x;\r\n  const ay = (r2 * y - Math.sqrt(r2 * x2 * (-r2 + x2 + y2))) / (x2 + y2) + c1.y;\r\n  const bx =\r\n    (x === 0 ? -c1.r : (-(y * Math.sqrt(r2 * x2 * (-r2 + x2 + y2))) + r2 * x2) / (x3 + x * y2)) +\r\n    c1.x;\r\n  const by = (r2 * y + Math.sqrt(r2 * x2 * (-r2 + x2 + y2))) / (x2 + y2) + c1.y;\r\n  const i = Math.atan2(ay - c1.y, ax - c1.x);\r\n  const j = Math.atan2(by - c1.y, bx - c1.x);\r\n  const idx = Math.cos(i) * c2.r;\r\n  const idy = Math.sin(i) * c2.r;\r\n  const jdx = Math.cos(j) * c2.r;\r\n  const jdy = Math.sin(j) * c2.r;\r\n  ctx.beginPath();\r\n  ctx.moveTo(c2.x + idx, c2.y + idy);\r\n  ctx.lineTo(ax + idx, ay + idy);\r\n  ctx.lineTo(bx + jdx, by + jdy);\r\n  ctx.lineTo(c2.x + jdx, c2.y + jdy);\r\n  ctx.closePath();\r\n  ctx.fill();\r\n}","const noop = (_?: any) => {};\r\n\r\nexport const dummyCanvasContext: CanvasRenderingContext2D = {\r\n  canvas: {} as HTMLCanvasElement,\r\n  direction: 'ltr',\r\n  fillStyle: '#000000',\r\n  filter: 'none',\r\n  font: '10px sans-serif',\r\n  globalAlpha: 1,\r\n  globalCompositeOperation: 'source-over',\r\n  imageSmoothingEnabled: true,\r\n  imageSmoothingQuality: 'low',\r\n  lineCap: 'butt',\r\n  lineDashOffset: 0,\r\n  lineJoin: 'miter',\r\n  lineWidth: 1,\r\n  miterLimit: 10,\r\n  shadowBlur: 0,\r\n  shadowColor: 'rgba(0, 0, 0, 0)',\r\n  shadowOffsetX: 0,\r\n  shadowOffsetY: 0,\r\n  strokeStyle: '#000000',\r\n  textAlign: 'start',\r\n  textBaseline: 'alphabetic',\r\n  save: noop,\r\n  restore: noop,\r\n  scale: noop,\r\n  rotate: noop,\r\n  translate: noop,\r\n  transform: noop,\r\n  setTransform: noop,\r\n  getTransform: () => new DOMMatrix(),\r\n  resetTransform: noop,\r\n  createLinearGradient: () => ({ addColorStop: noop }),\r\n  createRadialGradient: () => ({ addColorStop: noop }),\r\n  createPattern: () => null,\r\n  clearRect: noop,\r\n  fillRect: noop,\r\n  strokeRect: noop,\r\n  beginPath: noop,\r\n  fill: noop,\r\n  stroke: noop,\r\n  drawFocusIfNeeded: noop,\r\n  getContextAttributes: () => ({}),\r\n  clip: noop,\r\n  isPointInPath: () => false,\r\n  isPointInStroke: () => false,\r\n  fillText: noop,\r\n  strokeText: noop,\r\n  measureText: () => ({\r\n    actualBoundingBoxAscent: 0,\r\n    actualBoundingBoxDescent: 0,\r\n    actualBoundingBoxLeft: 0,\r\n    actualBoundingBoxRight: 0,\r\n    alphabeticBaseline: 0,\r\n    emHeightAscent: 0,\r\n    emHeightDescent: 0,\r\n    fontBoundingBoxAscent: 0,\r\n    fontBoundingBoxDescent: 0,\r\n    hangingBaseline: 0,\r\n    ideographicBaseline: 0,\r\n    width: 0,\r\n  }),\r\n  drawImage: noop,\r\n  getImageData: () => new ImageData(1, 1),\r\n  putImageData: noop,\r\n  createImageData: () => new ImageData(1, 1),\r\n  setLineDash: noop,\r\n  getLineDash: () => [],\r\n  closePath: noop,\r\n  moveTo: noop,\r\n  lineTo: noop,\r\n  quadraticCurveTo: noop,\r\n  bezierCurveTo: noop,\r\n  arcTo: noop,\r\n  rect: noop,\r\n  arc: noop,\r\n  ellipse: noop,\r\n};","export interface StylusState {\r\n  x: number;\r\n  y: number;\r\n  pressure: number; // 0~1\r\n  tangentialPressure: number; // -1~1\r\n  tiltX: number; // -90~90\r\n  tiltY: number; // -90~90\r\n  twist: number; // 0~359\r\n}\r\n\r\nexport const getStylusState = (\r\n  e: PointerEvent,\r\n) => ({\r\n  x: e.offsetX,\r\n  y: e.offsetY,\r\n  pressure: (e.pointerType === 'mouse')\r\n    ? 1\r\n    : e.pressure,\r\n  tangentialPressure: e.tangentialPressure,\r\n  tiltX: e.tiltX,\r\n  tiltY: e.tiltY,\r\n  twist: e.twist,\r\n});\r\n\r\nexport function createStylusState(): StylusState {\r\n  return {\r\n    x: 0,\r\n    y: 0,\r\n    pressure: 0,\r\n    tangentialPressure: 0,\r\n    tiltX: 0,\r\n    tiltY: 0,\r\n    twist: 0,\r\n  };\r\n}\r\n\r\nconst dummyStylusState = createStylusState();\r\nexport function createStylusStates(\r\n  length: number,\r\n  prototype: Readonly<StylusState> = dummyStylusState\r\n): StylusState[] {\r\n  return Array.from({ length }, () => cloneStylusState(prototype));\r\n}\r\n\r\nexport function cloneStylusState(stylusState: Readonly<StylusState>): StylusState {\r\n  const { x, y, pressure, tangentialPressure, tiltX, tiltY, twist } = stylusState;\r\n  return { x, y, pressure, tangentialPressure, tiltX, tiltY, twist };\r\n}\r\n\r\nexport function copyStylusState(dst: StylusState, src: Readonly<StylusState>) {\r\n  dst.x = src.x;\r\n  dst.y = src.y;\r\n  dst.pressure = src.pressure;\r\n  dst.tangentialPressure = src.tangentialPressure;\r\n  dst.tiltX = src.tiltX;\r\n  dst.tiltY = src.tiltY;\r\n  dst.twist = src.twist;\r\n}\r\n\r\nexport function interpolateStylusState(target: StylusState, to: Readonly<StylusState>, t: number) {\r\n  target.x = lerp(target.x, to.x, t);\r\n  target.y = lerp(target.y, to.y, t);\r\n  target.pressure = lerp(target.pressure, to.pressure, t);\r\n  target.tangentialPressure = lerp(target.tangentialPressure, to.tangentialPressure, t);\r\n  target.tiltX = lerp(target.tiltX, to.tiltX, t);\r\n  target.tiltY = lerp(target.tiltY, to.tiltY, t);\r\n  target.twist = lerpAngle(target.twist, to.twist, t);\r\n}\r\n\r\nfunction lerp(a: number, b: number, t: number) {\r\n  return a + (b - a) * t;\r\n}\r\n\r\nfunction lerpAngle(a: number, b: number, t: number) {\r\n  const c = ((((b - a) % 360) + 540) % 360) - 180;\r\n  return a + ((c * t) % 360);\r\n}","import { first, fromEvent, merge, shareReplay, switchMap, switchMapTo, takeLast, takeUntil, tap } from 'rxjs';\r\n\r\nexport const pointerdown = (element: Element) => fromEvent<PointerEvent>(element, 'pointerdown').pipe(\r\n  tap((evt) => {\r\n    element.setPointerCapture(evt.pointerId);\r\n    evt.preventDefault();\r\n    evt.stopPropagation();\r\n  }),\r\n);\r\n\r\nexport const pointermove = (element: Element) => fromEvent<PointerEvent>(element, 'pointermove');\r\n\r\nexport const pointerup = (element: Element) => merge(\r\n  fromEvent<PointerEvent>(element, 'pointerup'),\r\n  fromEvent<PointerEvent>(element, 'pointerleave'),\r\n  fromEvent<PointerEvent>(element, 'pointercancel'),\r\n  // fromEvent<PointerEvent>(element, 'pointerout'),\r\n).pipe(\r\n  tap((evt) => {\r\n    element.releasePointerCapture(evt.pointerId);\r\n  }),\r\n  first(),\r\n);\r\n\r\n\r\nexport const pointerdrag = (\r\n  element: Element,\r\n) => {\r\n\r\n  const down$ = pointerdown(element).pipe(\r\n\r\n    shareReplay(),\r\n  );\r\n  const move$ = pointermove(element);\r\n  const up$ = pointerup(element);\r\n\r\n  return merge(\r\n    down$,\r\n    down$.pipe(switchMapTo(move$.pipe(takeUntil(up$)))),\r\n    up$,\r\n  );\r\n}\r\n\r\n","import { DOCUMENT } from \"@angular/common\";\r\nimport { Directive, Inject, Input, OnDestroy } from \"@angular/core\";\r\n\r\n@Directive({\r\n  selector: `[file]`,\r\n})\r\nexport class FileDownloadDirective implements OnDestroy {\r\n\r\n  private a = this.document.createElement('a');\r\n\r\n  @Input('file') set src(file: File | null) {\r\n    if (file) {\r\n      const downloadLink = URL.createObjectURL(file)\r\n\r\n      this.a.href = downloadLink;\r\n      this.a.download = 'test.json';\r\n  \r\n      this.a.click();\r\n    }\r\n  };\r\n\r\n\r\n  constructor(\r\n    @Inject(DOCUMENT) private readonly document: Document,\r\n  ) {}\r\n\r\n  ngOnDestroy(): void {\r\n    this.a.remove();\r\n  }\r\n}\r\n","import { Directive, ElementRef, Input, OnDestroy, Output, Renderer2 } from '@angular/core';\r\nimport { BehaviorSubject, connectable, Subscription } from 'rxjs';\r\nimport { map, pluck, tap, withLatestFrom,  } from 'rxjs/operators';\r\nimport { coerceBooleanProperty } from './coerce-boolean-property';\r\nimport { FilesDrop } from './file-drop';\r\n\r\n@Directive({\r\n  selector: '[fileDrop]',\r\n  exportAs: 'fileDrop',\r\n})\r\nexport class FileDropDirective implements OnDestroy {\r\n\r\n  private readonly multiple$ = new BehaviorSubject<boolean>(false);\r\n\r\n  @Input() set multiple(multiple: any ) {\r\n    this.multiple$.next(coerceBooleanProperty(multiple))\r\n  }\r\n\r\n  private readonly dilesDrop = new FilesDrop(this.el.nativeElement)\r\n\r\n  @Output() readonly fileChange = connectable<any>(this.dilesDrop.dragAndDrop$.pipe(\r\n    map((drop) => drop?.dataTransfer?.files as any),\r\n    withLatestFrom(this.multiple$),\r\n    map(([filesList, multiple]) => multiple\r\n      ? Array.from(filesList)\r\n      : filesList.item(0)\r\n    ),\r\n  ));\r\n\r\n  private readonly overClassSubscription = this.dilesDrop.over$\r\n    .subscribe((isOver) => {\r\n      if (isOver) {\r\n        this.render.addClass(this.el.nativeElement, 'dragover');\r\n      } else {\r\n        this.render.removeClass(this.el.nativeElement, 'dragover');\r\n      }\r\n    });\r\n\r\n  private subscription = new Subscription();\r\n\r\n  constructor(\r\n    private readonly el: ElementRef<HTMLElement>,\r\n    private readonly render: Renderer2,\r\n  ) {\r\n    this.subscription.add(this.overClassSubscription)\r\n    this.subscription.add(this.fileChange.connect());\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.subscription.unsubscribe();\r\n  }\r\n}\r\n","import { fromEvent, merge, Observable, of } from 'rxjs';\r\nimport { delay, distinctUntilChanged, map, mapTo, mergeMap, pluck, share, shareReplay, switchMapTo, takeUntil, tap } from 'rxjs/operators';\r\n\r\n\r\nexport class FilesDrop {\r\n\r\n  constructor(\r\n    private readonly element: HTMLElement,\r\n  ) {}\r\n\r\n  private readonly dragover$ = fromEvent<DragEvent>(this.element, 'dragover');\r\n  private readonly dragleave$ = fromEvent<DragEvent>(this.element, 'dragleave').pipe(\r\n      mergeMap((event) => of(event)\r\n        .pipe(\r\n          delay(300),\r\n          takeUntil(this.dragover$),\r\n        ),\r\n      )\r\n    );\r\n\r\n  private readonly drop$ = fromEvent<DragEvent>(this.element, 'drop');\r\n\r\n  readonly over$: Observable<boolean> = merge(\r\n    this.dragover$.pipe(mapTo(true)),\r\n    merge(this.dragleave$, this.drop$).pipe(mapTo(false)),\r\n  ).pipe(\r\n    distinctUntilChanged(),\r\n    shareReplay(),\r\n  );\r\n\r\n  readonly dragAndDrop$: Observable<DragEvent> = this.dragover$.pipe(\r\n    tap((evt: DragEvent) => {\r\n      evt.preventDefault();\r\n      evt.stopPropagation();\r\n    }),\r\n    switchMapTo(this.drop$),\r\n    tap((evt: DragEvent) => {\r\n      evt.preventDefault();\r\n      evt.stopPropagation();\r\n    }),\r\n  );\r\n\r\n}","import { InjectionToken } from \"@angular/core\";\r\nimport { Observable, ReplaySubject } from \"rxjs\";\r\n\r\nexport const FILES_CHANGE = new InjectionToken<Observable<FileList>>('file change', {\r\n  providedIn: 'root',\r\n  factory: () => new ReplaySubject(),\r\n})\r\n","import { Pipe, PipeTransform } from \"@angular/core\";\r\nimport { Frame } from \"./interfaces/Frame\";\r\nimport { VideoTime } from \"./interfaces/VideoTime\";\r\nimport { videoTimeToFrame } from \"./video/videoTimeToFrame\";\r\n\r\nconst DEFAULT_FRAME_RATE = 29.97;\r\nconst DEFAULT_START_TIME = 0 as VideoTime;\r\n\r\n/**  Frame */\r\n@Pipe({name: 'frame'})\r\nexport class FramePipe implements PipeTransform {\r\n  transform(\r\n    currentTime: VideoTime | null = DEFAULT_START_TIME,\r\n    fps: number | null = DEFAULT_FRAME_RATE\r\n  ): Frame {\r\n    if (currentTime !== null && fps !== null) {\r\n      return videoTimeToFrame(currentTime, fps);\r\n    }\r\n\r\n    return 0 as Frame;\r\n  }\r\n}","import { Pipe, PipeTransform } from \"@angular/core\";\r\nimport { VideoTime } from \"./interfaces/VideoTime\";\r\nimport { secondsToTimecode, Timecode } from \"./video/secondsToTimecode\";\r\n\r\nconst DEFAULT_FRAME_RATE = 29.97;\r\nconst DEFAULT_START_TIME = 0 as VideoTime;\r\n\r\n/**  TimeCode */\r\n@Pipe({name: 'timecode'})\r\nexport class TimecodePipe implements PipeTransform {\r\n  transform(\r\n    currentTime: VideoTime | null = DEFAULT_START_TIME,\r\n    fps: number | null = DEFAULT_FRAME_RATE\r\n  ): Timecode {\r\n    if (currentTime !== null && fps !== null) {\r\n      return secondsToTimecode(currentTime, fps);\r\n    }\r\n\r\n    return '' as Timecode;\r\n  }\r\n}","import { Directive, ElementRef, Inject, Input, OnDestroy, Renderer2 } from '@angular/core';\r\nimport { combineLatest, first, map, merge, pipe, Subject, Subscription, switchMapTo, takeUntil, withLatestFrom } from 'rxjs';\r\n\r\nimport { pointerdown, pointermove, pointerup } from '../events/pointer';\r\nimport { Frame } from '../interfaces/Frame';\r\nimport { TimelinePosition } from '../interfaces/TimelinePosition';\r\nimport { VideoService } from '../video/video.service';\r\nimport { TimelineCommentsService } from './timeline-comment-store';\r\n\r\n\r\n@Directive({\r\n  selector: '[comment]'\r\n})\r\nexport class CommentDirective implements OnDestroy {\r\n\r\n  rect$ = new Subject<DOMRect>();\r\n  @Input() set rect(rect: DOMRect) {\r\n    this.rect$.next(rect);\r\n  };\r\n\r\n  frame$ = new Subject<Frame>();\r\n  @Input('comment') set frame(frame: Frame | string) {\r\n    this.frame$.next(frame as Frame);\r\n  };\r\n\r\n  private element = this.elementRef.nativeElement;\r\n\r\n  private down$ = pointerdown(this.element);\r\n  private move$ = pointermove(this.element);\r\n\r\n  private toFrame = pipe(\r\n    withLatestFrom<PointerEvent, [Frame, DOMRect]>(this.video.totalFrames$, this.rect$),\r\n    map(([pointerEvent, duration, rect]) => {\r\n      const pointerX = pointerEvent.offsetX;\r\n      const width = rect.width;\r\n\r\n      const position = (pointerEvent.offsetX <= 0)\r\n        ? 0\r\n        : (pointerX >= width)\r\n          ? width\r\n          : pointerX as TimelinePosition;\r\n  \r\n      return Math.floor(position * duration / width) as Frame\r\n    }),\r\n  )\r\n\r\n  drag$ = this.down$.pipe(switchMapTo(this.move$.pipe(takeUntil(pointerup(this.element))))).pipe(\r\n    this.toFrame,\r\n  );\r\n  \r\n  lastChange$ = this.down$.pipe(\r\n    switchMapTo(pointerup(this.element).pipe(\r\n      first()\r\n    ))).pipe(\r\n    this.toFrame,\r\n  )\r\n  \r\n  private subscription = new Subscription();\r\n\r\n  constructor(\r\n    private readonly render: Renderer2,\r\n    private readonly elementRef: ElementRef<Element>,\r\n    @Inject(TimelineCommentsService) readonly timelineComments: TimelineCommentsService,\r\n    @Inject(VideoService) private readonly video: VideoService,\r\n  ) {\r\n    console.log(`comment created!`);\r\n\r\n    this.subscription.add(\r\n      this.lastChange$.pipe(\r\n        withLatestFrom(this.frame$),\r\n        map(([drag, frame]) => [frame, drag]),\r\n      ).subscribe((data) => {\r\n        timelineComments.move$.next(data as [Frame, Frame]);\r\n      })\r\n    )\r\n\r\n    \r\n\r\n    this.subscription.add(\r\n      combineLatest([\r\n        merge(this.drag$, this.frame$), this.video.totalFrames$, this.rect$])\r\n      .pipe(\r\n      map(([time, duration, rect]) => ((time / duration * rect.width) || 0) as TimelinePosition),\r\n    ).subscribe((translate) => {\r\n      this.render.setAttribute(this.elementRef.nativeElement, 'transform', `translate(${translate})`);\r\n    }));\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.subscription.unsubscribe();\r\n  }\r\n}\r\n\r\n","import { Directive, ElementRef, Inject, Input, OnDestroy, Renderer2 } from '@angular/core';\r\nimport { combineLatest, map, merge, pipe, Subscription, switchMapTo, takeUntil, withLatestFrom } from 'rxjs';\r\n\r\nimport { pointerdown, pointermove, pointerup } from '../events/pointer';\r\nimport { TimelinePosition } from '../interfaces/TimelinePosition';\r\nimport { VideoTime } from '../interfaces/VideoTime';\r\nimport { VideoService } from '../video/video.service';\r\n\r\n\r\n@Directive({\r\n  selector: '[slider]'\r\n})\r\nexport class SliderDirective implements OnDestroy {\r\n\r\n  private element = this.elementRef.nativeElement;\r\n\r\n  @Input('slider') rect!: DOMRect;\r\n\r\n  private down$ = pointerdown(this.element);\r\n  private move$ = pointermove(this.element);\r\n\r\n  private toFrame = pipe(\r\n    withLatestFrom<PointerEvent, [VideoTime]>(this.video.duration$),\r\n    map(([pointerEvent, duration]) => {\r\n      const pointerX = pointerEvent.offsetX;\r\n      const width = this.rect.width;\r\n\r\n      const position = (pointerEvent.offsetX <= 0)\r\n        ? 0\r\n        : (pointerX >= width)\r\n          ? width\r\n          : pointerX as TimelinePosition;\r\n  \r\n      return (position * duration  / width) as VideoTime;\r\n    }),\r\n  )\r\n\r\n  drag$ = this.down$.pipe(switchMapTo(this.move$.pipe(takeUntil(pointerup(this.element))))).pipe(\r\n    this.toFrame,\r\n  );\r\n  \r\n  private subscription = new Subscription();\r\n\r\n  constructor(\r\n    private render: Renderer2,\r\n    private elementRef: ElementRef<Element>,\r\n    @Inject(VideoService) private readonly video: VideoService,\r\n  ) {\r\n    console.log(`slider created!`);\r\n\r\n    this.subscription.add(this.drag$.subscribe((time) => this.video.currentTimeChange$.next(time)));\r\n\r\n    this.subscription.add(combineLatest([\r\n      merge(\r\n        this.drag$,\r\n        this.video.currentTime$,\r\n      ),\r\n      this.video.duration$]).pipe(\r\n      map(([time, duration]) => ((time / duration * this.rect.width) || 0) as TimelinePosition),\r\n    ).subscribe((translate) => {\r\n      this.render.setAttribute(this.elementRef.nativeElement, 'transform', `translate(${translate})`);\r\n    }));\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.subscription.unsubscribe();\r\n  }\r\n}\r\n","import { Inject, Injectable, InjectionToken } from '@angular/core';\r\nimport { merge, Observable, ReplaySubject } from 'rxjs';\r\nimport { map } from 'rxjs/operators';\r\n\r\nimport { store } from '../canvas/store';\r\nimport { CommentsService } from '../comments/comments.service';\r\nimport { Frame } from '../interfaces/Frame';\r\n\r\n@Injectable()\r\nexport class TimelineCommentsService {\r\n  move$ = new ReplaySubject<[Frame, Frame]>();\r\n  store$ = timelineCommentStore(this.comments.store$, this.move$);\r\n\r\n  constructor(\r\n    @Inject(CommentsService) private readonly comments: CommentsService,\r\n  ) {}\r\n}\r\n\r\nexport const timelineCommentStore = (\r\n  store$: Observable<Map<Frame, ImageData>>,\r\n  lastMove: Observable<[Frame, Frame]>,\r\n) => store<Map<Frame, ImageData>>(\r\n  merge(\r\n    store$.pipe(\r\n      map((frames) => () => new Map(frames)),\r\n    ),\r\n    lastMove.pipe(\r\n      map(([oldFrame, newFrame]) => (store: Map<Frame, ImageData>) => {\r\n        const value = store.get(oldFrame)!;\r\n        store.delete(oldFrame);\r\n\r\n        store.set(newFrame, value);\r\n  \r\n        return store;\r\n      }),\r\n    )\r\n  ),\r\n  new Map(),\r\n);\r\n","import { KeyValue } from '@angular/common';\r\nimport { Component, Inject, OnDestroy } from '@angular/core';\r\nimport { map, Subscription, withLatestFrom } from 'rxjs';\r\n\r\nimport { CommentsService } from '../comments/comments.service';\r\nimport { Frame } from '../interfaces/Frame';\r\nimport { TimelineCommentsService } from './timeline-comment-store';\r\n\r\n\r\n@Component({\r\n  selector: 'timeline',\r\n  templateUrl: './timeline.component.html',\r\n  styleUrls: ['./timeline.component.scss'],\r\n  providers: [\r\n    TimelineCommentsService,\r\n  ],\r\n})\r\nexport class TimelineComponent implements OnDestroy {\r\n\r\n  trackByFn(_: number, item: KeyValue<Frame, ImageData>) {\r\n    return item.value;\r\n  }\r\n\r\n  private subscription = new Subscription();\r\n\r\n  constructor(\r\n    @Inject(TimelineCommentsService) readonly timelineComments: TimelineCommentsService,\r\n    @Inject(CommentsService) private readonly comments: CommentsService,\r\n  ) {\r\n    this.subscription.add(\r\n      timelineComments.move$.pipe(\r\n        withLatestFrom(timelineComments.store$),\r\n        map(([_, data]) => data),\r\n      ).subscribe((data) => {\r\n        this.comments.move$.next(data);\r\n      })\r\n    )\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this.subscription.unsubscribe();\r\n  }\r\n}","import { Directive, ElementRef } from '@angular/core';\r\n\r\n@Directive({\r\n  selector: 'rect[timeline]',\r\n  exportAs: 'timeline'\r\n})\r\nexport class TimelineDirective {\r\n\r\n  rect: DOMRect = this.element.nativeElement.getBBox();\r\n\r\n  constructor(\r\n    private readonly element: ElementRef<SVGRectElement>\r\n  ) {}\r\n}","import { CommonModule } from '@angular/common';\r\nimport { NgModule } from '@angular/core';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\n\r\nimport { AppCommonModule } from '../common/common.module';\r\nimport { CommentDirective } from './comment.directive';\r\nimport { SliderDirective } from './slider.directive';\r\nimport { TimelineComponent } from './timeline.component';\r\nimport { TimelineDirective } from './timeline.directive';\r\n\r\n@NgModule({\r\n  imports:      [\r\n    CommonModule,\r\n    FormsModule,\r\n    ReactiveFormsModule,\r\n    [\r\n      AppCommonModule,\r\n    ],\r\n  ],\r\n  declarations: [\r\n    TimelineComponent,\r\n    SliderDirective,\r\n    CommentDirective,\r\n    TimelineDirective,\r\n  ],\r\n  exports: [\r\n    TimelineComponent,\r\n  ],\r\n})\r\nexport class TimelineModule { }\r\n","import { Brand } from \"../interfaces/Brand.type\";\r\nimport { VideoTime } from \"../interfaces/VideoTime\";\r\n\r\nexport type Timecode = Brand<string, 'Timecode'>;\r\n\r\nexport function secondsToTimecode(time: VideoTime, fps: number): Timecode {\r\n\t\r\n\tvar hours = Math.floor(time / 3600) % 24;\r\n\tvar minutes = Math.floor(time / 60) % 60;\r\n\tvar seconds = Math.floor(time % 60);\r\n\tvar frames = Math.floor(((time % 1) * fps));\r\n\t\r\n\tvar result = (hours < 10 ? \"0\" + hours : hours) + \":\"\r\n\t+ (minutes < 10 ? \"0\" + minutes : minutes) + \":\"\r\n\t+ (seconds < 10 ? \"0\" + seconds : seconds) + \":\"\r\n\t+ (frames < 10 ? \"0\" + frames : frames);\r\n\r\n\treturn result as Timecode;\r\n\r\n}","import { Directive, ElementRef, Inject, OnDestroy } from '@angular/core';\r\nimport { fromEvent, groupBy, map, mergeMap, Observable } from 'rxjs';\r\nimport { withLatestFrom } from 'rxjs/operators';\r\n\r\nimport { VideoTime } from '../interfaces/VideoTime';\r\nimport { VideoService } from './video.service';\r\n\r\n\r\n@Directive({\r\n  selector: '[scroll]',\r\n})\r\nexport class ScrollDirective implements OnDestroy {\r\n\r\n  element = this.elementRef.nativeElement;\r\n\r\n  scroll$ = fromEvent<WheelEvent>(this.element, 'wheel');\r\n\r\n  private readonly subscription = this.scroll$.pipe(\r\n    groupBy((event) => event.deltaY > 0),\r\n    mergeMap((group$) => (group$.key)\r\n      ? this.scrollUp(group$)\r\n      : this.scrollDown(group$)\r\n    ),\r\n  ).subscribe((time) => {\r\n    this.video.currentTimeChange$.next(time);\r\n  })\r\n\r\n  constructor(\r\n    @Inject(VideoService) private readonly video: VideoService,\r\n    @Inject(ElementRef) private readonly elementRef: ElementRef<Element>,\r\n  ) {}\r\n\r\n  ngOnDestroy(): void {\r\n    this.subscription.unsubscribe();\r\n  }\r\n\r\n  scrollUp(scroll: Observable<WheelEvent>) {\r\n    return scroll.pipe(\r\n      withLatestFrom(this.video.frameSize$, this.video.currentTime$, this.video.duration$),\r\n      map(([_, frame, currentTime, duration]) => {\r\n        const nextTime = currentTime + frame as VideoTime;\r\n        return nextTime > duration ? currentTime as VideoTime : nextTime\r\n      }),\r\n    );\r\n  }\r\n\r\n  scrollDown(scroll: Observable<WheelEvent>) {\r\n    return scroll.pipe(\r\n      withLatestFrom(this.video.frameSize$, this.video.currentTime$, this.video.duration$),\r\n      map(([_, frame, currentTime]) => {\r\n        const nextTime = currentTime - frame as VideoTime;\r\n        return nextTime <= 0 ? currentTime as VideoTime : nextTime\r\n      }),\r\n    );\r\n  }\r\n\r\n}\r\n","import { Directive, ElementRef, Inject, OnDestroy } from '@angular/core';\r\n\r\nimport { VideoService } from './video.service';\r\n\r\n/**\r\n *   <video> \r\n * \r\n * [events](https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement#events)\r\n */\r\n@Directive({\r\n  selector: 'video',\r\n  exportAs: 'video',\r\n})\r\nexport class VideoDirective implements OnDestroy {\r\n\r\n  private subscription = this.video.currentTimeChange$\r\n    .subscribe((currentTime) => {\r\n      this.elementRef.nativeElement.currentTime = currentTime;\r\n    })\r\n\r\n  constructor(\r\n    @Inject(ElementRef) private readonly elementRef: ElementRef<HTMLVideoElement>,\r\n    @Inject(VideoService) private readonly video: VideoService,\r\n  ) {\r\n    video.video$.next(elementRef.nativeElement);\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.subscription.unsubscribe();\r\n  }\r\n\r\n  play() {\r\n    this.elementRef.nativeElement.play();\r\n  }\r\n\r\n  pause() {\r\n    this.elementRef.nativeElement.pause();\r\n  }\r\n}\r\n\r\n","import { Inject, Injectable } from '@angular/core';\r\nimport { DomSanitizer } from '@angular/platform-browser';\r\nimport {\r\n  animationFrameScheduler,\r\n  BehaviorSubject,\r\n  combineLatest,\r\n  filter,\r\n  fromEvent,\r\n  map,\r\n  merge,\r\n  Observable,\r\n  ReplaySubject,\r\n  shareReplay,\r\n  startWith,\r\n  switchMap,\r\n  switchMapTo,\r\n  takeUntil,\r\n  tap,\r\n  timer,\r\n} from 'rxjs';\r\n\r\nimport { FILES_CHANGE } from '../files-change';\r\nimport { Frame } from '../interfaces/Frame';\r\nimport { VideoTime } from '../interfaces/VideoTime';\r\nimport { videoTimeToFrame } from './videoTimeToFrame';\r\n\r\nexport const DEFAULT_FRAME_RATE = 29.97;\r\n\r\n@Injectable()\r\nexport class VideoService {\r\n\r\n  readonly video$ = new ReplaySubject<HTMLVideoElement>();\r\n  readonly fps$ = new BehaviorSubject(DEFAULT_FRAME_RATE);\r\n  readonly frameSize$ = videoFrameSize(this.fps$);\r\n  \r\n\r\n  readonly duration$ = videoDuration(this.video$);\r\n  readonly totalFrames$ = videoTotalFrames(this.duration$, this.fps$);\r\n  \r\n\r\n  readonly currentTimeChange$ = new ReplaySubject<VideoTime>();\r\n  readonly currentTime$ = videoCurrentTime(this.video$, this.currentTimeChange$);\r\n  readonly currentFrame$ = videoCurrentFrame(this.currentTime$, this.fps$);\r\n\r\n  private readonly file$ = videoFileChange(this.files$);\r\n  readonly src$ = videoSrc(this.file$, this.sanitizer)\r\n\r\n  constructor(\r\n    @Inject(FILES_CHANGE) private readonly files$: Observable<FileList>,\r\n    @Inject(DomSanitizer) private readonly sanitizer: DomSanitizer,\r\n  ) {}\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nfunction videoCurrentFrame(\r\n  currentTime$: Observable<VideoTime>,\r\n  fps$: Observable<number>,\r\n): Observable<Frame> {\r\n  return combineLatest([\r\n    currentTime$,\r\n    fps$,\r\n  ]).pipe(\r\n    map(([time, fps]) => videoTimeToFrame(time, fps)),\r\n    shareReplay(),\r\n  )\r\n}\r\n\r\n\r\n\r\nconst VIDEO_START_TIME = 0 as VideoTime;\r\nfunction videoCurrentTime(\r\n  video$: Observable<HTMLVideoElement>,\r\n  currentTime$: Observable<VideoTime>,\r\n): Observable<VideoTime> {\r\n  const play$ = video$.pipe(\r\n    switchMap((video) => {\r\n\r\n      const play$ = fromEvent<Event>(video, 'play');\r\n      const pause$ = fromEvent<Event>(video, 'pause');\r\n\r\n      return play$.pipe(switchMapTo(timer(0, 0, animationFrameScheduler).pipe(\r\n        map(() => video.currentTime as VideoTime),\r\n\r\n        takeUntil(pause$)\r\n      )));\r\n      }\r\n    ),\r\n\r\n  );\r\n\r\n  return merge(\r\n    play$,\r\n    currentTime$,\r\n  ).pipe(\r\n    startWith(VIDEO_START_TIME),\r\n    shareReplay(),\r\n  )\r\n}\r\n\r\nfunction videoDuration(\r\n  video$: Observable<HTMLVideoElement>\r\n): Observable<VideoTime> {\r\n  return video$.pipe(\r\n    switchMap((video) => fromEvent<Event>(video, 'durationchange').pipe(\r\n      map(() => video.duration as VideoTime),\r\n    )),\r\n    tap((e) => {\r\n      console.log(`duration`, e);\r\n    }),\r\n    shareReplay(),\r\n  );\r\n}\r\n\r\nfunction isVideoFile(file: File) {\r\n  return file.type === 'video/mp4';\r\n}\r\n\r\nfunction videoFileChange(files$: Observable<FileList>): Observable<File> {\r\n  return files$.pipe(\r\n    map((files) => Array.from(files)),\r\n    map((files) => files.find(isVideoFile)!),\r\n    filter((v) => !!v),\r\n  );\r\n}\r\n\r\n\r\n\r\nfunction videoSrc(\r\n  file$: Observable<File>,\r\n  sanitizer: DomSanitizer,\r\n): Observable<string> {\r\n\r\n  return file$.pipe(\r\n    map((file) => URL.createObjectURL(file)),\r\n    map((src) => sanitizer.bypassSecurityTrustUrl(src) as string),\r\n    startWith('https://www.html5rocks.com/tutorials/video/basics/Chrome_ImF.ogv'),\r\n    // startWith('https://mdn.github.io/learning-area/javascript/apis/video-audio/finished/video/sintel-short.mp4')\r\n  )\r\n}\r\n\r\nfunction videoTotalFrames(\r\n  duration$: Observable<VideoTime>,\r\n  fps$: Observable<number>\r\n): Observable<Frame> {\r\n  return combineLatest([\r\n    duration$,\r\n    fps$,\r\n  ]).pipe(\r\n    map(([time, fps]) => videoTimeToFrame(time, fps)),\r\n    shareReplay(),\r\n  )\r\n}\r\n\r\n\r\nfunction videoFrameSize(\r\n  fps$: Observable<number>\r\n): Observable<VideoTime> {\r\n  return fps$.pipe(map((fps) => (1 / fps) as VideoTime));\r\n}","import { Frame } from \"../interfaces/Frame\";\r\nimport { VideoTime } from \"../interfaces/VideoTime\";\r\n\r\nexport const videoTimeToFrame = (\r\n  time: VideoTime,\r\n  fps: number\r\n): Frame => Math.floor(time * fps) as Frame;\r\n\r\nexport const frameToVideoTime = (\r\n  frame: Frame,\r\n  fps: number\r\n): VideoTime => frame / fps as VideoTime;","import { NgModuleRef } from '@angular/core';\nimport { platformBrowserDynamic } from '@angular/platform-browser-dynamic';\nimport { AppModule } from './app/app.module';\n\n\nplatformBrowserDynamic().bootstrapModule(AppModule, {\n  ngZone: 'noop'\n}).then((ref) => {\n\n  const win = window as Window & typeof globalThis & { ngRef: NgModuleRef<AppModule> }\n\n  // Ensure Angular destroys itself on hot reloads.\n  if (win.ngRef) {\n    win.ngRef.destroy();\n  }\n  win.ngRef = ref;\n\n  // Otherwise, log the boot error\n}).catch(err => console.error(err));","export default \"<div class=\\\"wrapper\\\"\\n     scroll>\\n  <canvas paint></canvas>\\n  <video #video=\\\"video\\\"\\n         [src]=\\\"src$ | push\\\"></video>\\n</div>\\n\\n<div>\\n  <input type=\\\"file\\\"\\n         multiple\\n         ngModel\\n         (ngModelChange)=\\\"filesInput.next($event)\\\">\\n\\n  <color-selector></color-selector>\\n\\n  <input type=\\\"range\\\"\\n         min=\\\"0.1\\\"\\n         max=\\\"50\\\"\\n         [ngModel]=\\\"brush.size$ | push\\\"\\n         (ngModelChange)=\\\"brush.size$.next($event)\\\">\\n\\n  <select [ngModel]=\\\"brush.compositeOperation$ | push\\\"\\n          (ngModelChange)=\\\"brush.compositeOperation$.next($event)\\\">\\n    <option *ngFor=\\\"let item of brush.compositeOperations\\\"\\n            [ngValue]=\\\"item.value\\\">{{ item.name }}</option>\\n  </select>\\n\\n  <button (click)=\\\"video.play()\\\">play</button>\\n  <button (click)=\\\"video.pause()\\\">pause</button>\\n</div>\\n\\n<!-- <div>\\n  <button (click)=\\\"comments.clear$.next()\\\">clear</button>\\n</div> -->\\n\\n<div>\\n  <span>frame rate: {{ fps$ | push }}</span>\\n  <select [formControl]=\\\"frameRate.control\\\">\\n    <option *ngFor=\\\"let item of frameRates\\\"\\n            [ngValue]=\\\"item.value\\\">{{ item.name }}</option>\\n  </select>\\n  <input [value]=\\\"frameRate.control.value\\\"\\n         type=\\\"number\\\"\\n         [formControl]=\\\"frameRate.control\\\">\\n</div>\\n\\n\\n<span>Time:\\n\\n  <ng-container>{{ currentTime$ | push | timecode : (fps$ | push) }}</ng-container>\\n</span>\\n<span>Frame:\\n\\n  <ng-container>{{ currentFrame$ | push }}</ng-container>\\n\\n  /\\n\\n  <ng-container>{{ totalFrames$ | push }}</ng-container>\\n</span>\\n\\n\\n<div>\\n  <timeline></timeline>\\n</div>\\n\\n<div>\\n  <button (click)=\\\"comments.save$.next()\\\"\\n          [file]=\\\"(comments.file$ | push)\\\">Save</button>\\n</div>\\n\";","export default \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\"\\r\\n     viewBox=\\\"0 0 800 30\\\">\\r\\n  <rect timeline #timeline=\\\"timeline\\\"\\r\\n        x=\\\"0\\\"\\r\\n        y=\\\"10\\\"\\r\\n        width=\\\"800\\\"\\r\\n        height=\\\"20\\\"\\r\\n        fill=\\\"#007bff\\\" />\\r\\n\\r\\n  <g #slider\\r\\n     [slider]=\\\"timeline.rect\\\"\\r\\n     style=\\\"cursor: e-resize;\\\">\\r\\n    <rect x=\\\"-15\\\"\\r\\n          y=\\\"10\\\"\\r\\n          width=\\\"30\\\"\\r\\n          height=\\\"20\\\" />\\r\\n    <rect x=\\\"0\\\"\\r\\n          y=\\\"10\\\"\\r\\n          width=\\\"1\\\"\\r\\n          height=\\\"20\\\"\\r\\n          fill=\\\"#ffffff\\\" />\\r\\n  </g>\\r\\n\\r\\n  <g *ngFor=\\\"let item of (timelineComments.store$ | push | keyvalue); trackBy: trackByFn; let i = index\\\"\\r\\n     [comment]=\\\"item.key\\\"\\r\\n     [rect]=\\\"timeline.rect\\\"\\r\\n     style=\\\"cursor: e-resize;\\\">\\r\\n    <ellipse cx=\\\"0.5\\\"\\r\\n             cy=\\\"7\\\"\\r\\n             rx=\\\"3\\\"\\r\\n             ry=\\\"3\\\"\\r\\n             fill=\\\"#00ff00\\\" />\\r\\n    <rect x=\\\"0\\\"\\r\\n          y=\\\"10\\\"\\r\\n          width=\\\"1\\\"\\r\\n          height=\\\"20\\\"\\r\\n          fill=\\\"#ffffff\\\" />\\r\\n  </g>\\r\\n</svg>\\r\\n\";"],"names":["FileHandler","constructor","canvas","restore","file","reader","FileReader","readAsText","str","Promise","resolve","reject","onload","result","entries","Object","JSON","parse","dataPromises","map","key","value","img","Image","src","imageData","imageToImageData","data2","all","filledData","reduce","accumulator","_","index","set","parseInt","Map","save","data","base64Images","keys","base64","imageDataToBlop","then","blob","blobToBase64","push","images","dataImages","json","stringify","ImageData","get","File","type","readAsDataURL","ChangeDetectorRef","Pipe","stringify","isPromise","isSubscribable","invalidPipeArgumentError","Error","SubscribableStrategy","createSubscription","async","updateLatestValue","subscribe","next","error","e","dispose","subscription","unsubscribe","onDestroy","PromiseStrategy","promiseStrategy","subscribableStrategy","PushPipe","cd","ngOnDestroy","transform","obj","latestValue","strategy","selectStrategy","PushPipe_1","detectChanges","name","pure"],"sourceRoot":"webpack:///"}